# 3481 Apply Substitutions

You are given a replacements mapping and a text string that may contain placeholders formatted as %var%, where each var corresponds to a key in the replacements mapping. Each replacement value may itself contain one or more such placeholders. Each placeholder is replaced by the value associated with its corresponding replacement key.

Return the fully substituted text string which does not contain any placeholders.
 
[LeetCode](https://leetcode.cn/problems/apply-substitutions/description/)

### Example 1

```
Input: replacements = [["A","abc"],["B","def"]], text = "%A%_%B%"

Output: "abc_def"

Explanation:

The mapping associates "A" with "abc" and "B" with "def".
Replace %A% with "abc" and %B% with "def" in the text.
The final text becomes "abc_def".
```

### Example 2

```
Input: replacements = [["A","bce"],["B","ace"],["C","abc%B%"]], text = "%A%_%B%_%C%"

Output: "bce_ace_abcace"

Explanation:

The mapping associates "A" with "bce", "B" with "ace", and "C" with "abc%B%".
Replace %A% with "bce" and %B% with "ace" in the text.
Then, for %C%, substitute %B% in "abc%B%" with "ace" to obtain "abcace".
The final text becomes "bce_ace_abcace".
```

### Constraints

* 1 <= replacements.length <= 10
* Each element of replacements is a two-element list [key, value], where:
* key is a single uppercase English letter.
* value is a non-empty string of at most 8 characters that may contain zero or more placeholders formatted as %<key>%.
* All replacement keys are unique.
* The text string is formed by concatenating all key placeholders (formatted as %<key>%) randomly from the replacements mapping, separated by underscores.
* text.length == 4 * replacements.length - 1
* Every placeholder in the text or in any replacement value corresponds to a key in the replacements mapping.
* There are no cyclic dependencies between replacement keys.

### C++ 

```
class Solution {
public:
    string applySubstitutions(vector<vector<string>>& replacements, string text) {
        /*
            1. 先整理所有的替換，若替換的字符串中也有替換，同時處理
            2. 替換text中的文字
        */
        vector<string> strMap(26);
        queue<int> que;
        //整理對成應的表
        for(const vector<string>& strs : replacements){
            int&& key = strs[0][0] - 'A';
            const string& str = strs[1];
            if(str.find('%') != string::npos)
                que.push(key);
            strMap[key] = str;
        }

        //進一步整理表中有%的string
        while(que.empty() != true){
            int key = que.front();
            que.pop();
            string& keyStr = strMap[key];
            int idx = keyStr.find('%');
            int&& insideKey = keyStr[idx + 1] - 'A';
            string reStr = keyStr.substr(0, idx) + strMap[insideKey];
            if(idx + 3 < keyStr.length())
                reStr += keyStr.substr(idx + 3);
            strMap[key] = reStr;
            if(reStr.find('%') != string::npos)
                que.push(key);
        }

        string ret;
        for(int i = 0; i < text.length(); ++i){
            if(text[i] != '%'){
                ret.push_back(text[i]);
                continue;
            }
            ret.append(strMap[text[i + 1] - 'A']);
            i += 2; 
        }

        return ret;        
    }
};
```